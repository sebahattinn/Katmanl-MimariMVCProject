@model IEnumerable<OnlineGallery.Models.User>

<h2>@ViewData["Title"]</h2>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">
        @TempData["SuccessMessage"]
    </div>
}

<div id="user-list-container">
    @Html.Partial("UserList", Model)
</div>

<div class="mt-3">
    <button id="add-user" class="btn btn-success">Kullanıcı Ekle</button>
    <button id="delete-user" class="btn btn-danger">Kullanıcı Sil</button>
    <button id="edit-user" class="btn btn-warning">Kullanıcı Düzenle</button>
    <button id="load-user-list" class="btn btn-primary">Kullanıcıları Listele</button>
</div>

<div id="add-user-form-container" style="display: none;">
    @Html.Partial("EditUserPartialView", new OnlineGallery.Models.User())
</div>

<script>
    document.getElementById('load-user-list').addEventListener('click', function () {
        fetch('@Url.Action("GetUserList", "Admin")')
            .then(response => response.text())
            .then(data => {
                document.getElementById('user-list-container').innerHTML = data;
            });
    });

    document.getElementById('add-user').addEventListener('click', function () {
        // Kullanıcı ekleme formunu görünür yap
        document.getElementById('add-user-form-container').style.display = 'block';

        // Formun gösterilmesi için gerekli olan POST isteğini gönderebilirsiniz
        fetch('@Url.Action("AddUser", "Admin")')
            .then(response => response.text())
            .then(data => {
                document.getElementById('add-user-form-container').innerHTML = data;
            });
    });

    document.getElementById('delete-user').addEventListener('click', function () {
        const userId = prompt("Silmek istediğiniz kullanıcının ID'sini girin:");
        if (userId) {
            const isConfirmed = confirm("Bu kullanıcıyı silmek istediğinizden emin misiniz?");
            if (isConfirmed) {
                fetch('@Url.Action("DeleteUser", "Admin")', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(userId)
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.success ? 'Kullanıcı başarıyla silindi.' : data.message);
                    document.getElementById('refresh-user-list').click();
                });
            }
        }
    });

    document.getElementById('edit-user').addEventListener('click', function () {
        const userId = prompt("Düzenlemek istediğiniz kullanıcının ID'sini girin:");
        if (userId) {
            fetch('@Url.Action("EditUser", "Admin")?userId=' + userId)
                .then(response => response.text())
                .then(data => {
                    document.getElementById('user-list-container').innerHTML = data;
                });
        }
    });
</script>
